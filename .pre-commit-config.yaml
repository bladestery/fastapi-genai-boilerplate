repos:
  # --- Black for formatting (auto-fix) ---
  - repo: https://github.com/psf/black
    rev: "25.1.0"
    hooks:
      - id: black
        name: Format code using Black
        args: ["--line-length", "88"]

  # --- Ruff for linting & fixing ---
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: "v0.13.0"
    hooks:
      - id: ruff
        name: Lint and auto-fix with Ruff
        args: ["--fix", "--exit-non-zero-on-fix"] # Auto-fixes common issues
      - id: ruff-format
        name: Format code using Ruff
        args: ["--line-length=88"]

  # --- isort for import sorting (Black-compatible, auto-fix) ---
  - repo: https://github.com/pre-commit/mirrors-isort
    rev: v5.10.1
    hooks:
      - id: isort
        name: Sort imports using isort (Black-compatible)
        args: ["--profile", "black", "--line-length", "88"]

  # --- Standard pre-commit hooks ---
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: "v6.0.0"
    hooks:
      - id: trailing-whitespace
        name: Remove trailing whitespace
        args: ["--markdown-linebreak-ext=md"]
      - id: end-of-file-fixer
        name: Ensure newline at end of file
      - id: mixed-line-ending
        name: Normalize line endings to LF
        args: ["--fix=lf"]
      - id: check-yaml
        name: Validate YAML syntax
        exclude: ^charts/.*\.yaml$
      - id: check-ast
        name: Validate Python AST
      - id: check-json
        name: Validate JSON files
      - id: check-merge-conflict
        name: Check for unresolved merge conflicts
      - id: detect-private-key
        name: Detect committed private keys
      - id: check-case-conflict
        name: Check for case-insensitive filename conflicts
      - id: check-docstring-first
        name: Ensure module docstrings are first statements
      - id: check-symlinks
        name: Validate symlinks
      - id: check-toml
        name: Validate TOML files

  # --- Mypy for type checking ---
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: "v1.17.1"
    hooks:
      - id: mypy
        name: Run Mypy type checks
        args:
          [
            "--explicit-package-bases",
            "--ignore-missing-imports",
            "--disallow-untyped-defs",
            "--pretty",
          ]
        additional_dependencies:
          - types-requests
          - types-PyYAML
          - types-python-dateutil
          - types-setuptools

  # --- Local pytest runner (optional auto-run if tests exist) ---
  - repo: local
    hooks:
      - id: pytest
        name: Run pytest suite
        entry: bash
        language: system
        types: [python]
        verbose: true
        pass_filenames: false
        always_run: true
        args:
          - -c
          - |
            echo "üîç Checking for tests..."
            if ls tests/test_*.py >/dev/null 2>&1; then
              echo "‚úÖ Found test files. Running pytest..."
              uv run pytest --disable-warnings -q
            else
              echo "‚ö†Ô∏è No test files found. Skipping pytest."
              exit 0
            fi
